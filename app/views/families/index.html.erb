<nav class="navbar navbar-expand-lg" style="background-color: #FF5A5F;">
  <div class="container-fluid">
    <%= link_to "Rent Your Family", root_path, class: "navbar-brand text-white fw-bold" %>

    <div class="ms-auto d-flex gap-2">
      <% if user_signed_in? %>
        <% if current_user.role == "provider" %>
          <%= link_to "Dashboard", providers_path, class: "btn btn-light fw-semibold text-danger" %>
        <% elsif current_user.role == "guest" %>
          <%= link_to "Dashboard", guests_path, class: "btn btn-light fw-semibold text-danger" %>
        <% end %>
        <%= link_to "Logout", destroy_user_session_path, method: :delete, data: { turbo_method: :delete }, class: "btn btn-light fw-semibold text-danger" %>
      <% else %>
        <%= link_to "Login", new_user_session_path, class: "btn btn-light fw-semibold text-danger" %>
        <%= link_to "Register Your Family", new_provider_path, class: "btn btn-light fw-semibold text-danger" %>
      <% end %>
    </div>
  </div>
</nav>

<div class="container-fluid mt-4">
  <h1 class="d-flex justify-content-center gap-2">
    <img src="<%= asset_path('family.png') %>" alt="family" style="height: 40px;">Families
  </h1>

  <div class="row justify-content-center">
    <div class="col-sm-8 my-3">
      <%= form_with url: families_path, method: :get, class: "d-flex" do %>
        <%= text_field_tag :query, params[:query], class: "form-control", placeholder: "Type a keyword", style: "background-color: white;" %>
        <%= submit_tag "Search", name: "", class: "btn btn-primary ms-2" %>
      <% end %>
    </div>
  </div>

  <div class="rounded-3 border border-2 p-4 w-100 mt-4 shadow-sm bg-white">
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 m-2">
      <% if @families.empty? %>
        <h1 class="text-center">No search results, try again</h1>
      <% else %>
        <% @families.each do |family| %>
          <div class="col">
            <div class="card h-100 shadow-sm">
              <% if family.photo.attached? %>
                <%= image_tag family.photo,
                    alt: "#{family.members} photo",
                    class: "card-img-top img-fluid border-bottom",
                    style: "object-fit: cover; height: 250px; width: 100%;" %>
              <% else %>
                <%= image_tag "https://image.pollinations.ai/prompt/japanese_family_called_#{family.members}",
                    alt: "Random family",
                    class: "card-img-top img-fluid border-bottom",
                    style: "object-fit: cover; height: 250px; width: 100%;" %>
              <% end %>

              <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <h5 class="card-title fw-bold">
                    <%= link_to family.members, family_path(family), class: "text-decoration-none text-dark" %>
                  </h5>
                  <% if family.rating.present? %>
                    <h6 class="text-end"> <%= '🌟' * family.rating.to_i %> (<%= family.rating %>) </h6>
                  <% else %>
                    <p class="text-end text-muted">Newly Registered!</p>
                  <% end %>
                </div>

                <p class="mb-2 text-muted"><strong>📍 Location:</strong> <span class="text-dark"><%= family.location %></span></p>
                <p class="mb-2 text-muted"><strong>📅 Available for:</strong> <span class="text-dark"><%= family.event_type %></span></p>
                <p class="mb-0 text-muted"><strong>💴 Hourly Rate:</strong> <span class="text-dark">¥<%= family.hourly_rate %></span></p>
              </div>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
</div>